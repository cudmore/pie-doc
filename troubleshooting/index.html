



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Raspberry Pi Controlled Experiment (PiE)">
      
      
      
        <meta name="author" content="Robert H Cudmore">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../img/icons/video-camera-blue.png">
      <meta name="generator" content="mkdocs-0.17.2, mkdocs-material-2.2.2">
    
    
      
        <title>Troubleshooting - PiE Docs</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.7a4cdee3.css">
      
    
    
      <script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
    
  </head>
  
    <body>
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="PiE Docs" class="md-header-nav__button md-logo">
          
            <img src="../img/icons/video-camera-blue.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                PiE Docs
              </span>
              <span class="md-header-nav__topic">
                Troubleshooting
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" required placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset">&#xE5CD;</button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/cudmore/pie" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      PiE Repository
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <span class="md-nav__button md-logo">
      
        <img src="../img/icons/video-camera-blue.png" width="24" height="24">
      
    </span>
    PiE Docs
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/cudmore/pie" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      PiE Repository
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Raspberry Pi Controlled Experiment (PiE)" class="md-nav__link">
      Raspberry Pi Controlled Experiment (PiE)
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../about/" title="About" class="md-nav__link">
      About
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../commander/" title="Commander" class="md-nav__link">
      Commander
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../file-server/" title="File server" class="md-nav__link">
      File server
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../gpio-timing/" title="Gpio timing" class="md-nav__link">
      Gpio timing
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../images/" title="Images" class="md-nav__link">
      Images
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../implementation-details/" title="Implementation details" class="md-nav__link">
      Implementation details
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../install/" title="Install the PiE server" class="md-nav__link">
      Install the PiE server
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../mount-usb-drive/" title="Mount usb drive" class="md-nav__link">
      Mount usb drive
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../parts/" title="Parts" class="md-nav__link">
      Parts
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../readme/" title="Raspberry Pi Controlled Experiment (PiE)" class="md-nav__link">
      Raspberry Pi Controlled Experiment (PiE)
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../release-notes/" title="Release notes" class="md-nav__link">
      Release notes
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../rest-interface/" title="Rest interface" class="md-nav__link">
      Rest interface
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../trial-file/" title="Trial file" class="md-nav__link">
      Trial file
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Troubleshooting
      </label>
    
    <a href="./" title="Troubleshooting" class="md-nav__link md-nav__link--active">
      Troubleshooting
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#common-errors" title="Common Errors" class="md-nav__link">
    Common Errors
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#oserror-errno-98-address-already-in-use" title="OSError: [Errno 98] Address already in use" class="md-nav__link">
    OSError: [Errno 98] Address already in use
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting-the-camera" title="Troubleshooting the camera" class="md-nav__link">
    Troubleshooting the camera
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bcamera-picamerammalerror-failed-to-enable-connection-out-of-resources" title="bCamera PiCameraMMALError: Failed to enable connection: Out of resources" class="md-nav__link">
    bCamera PiCameraMMALError: Failed to enable connection: Out of resources
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting-a-dht-temperaturehumidity-sensor" title="Troubleshooting a DHT temperature/humidity sensor" class="md-nav__link">
    Troubleshooting a DHT temperature/humidity sensor
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#converting-video-to-mp4" title="Converting video to mp4" class="md-nav__link">
    Converting video to mp4
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting-uv4l-streaming" title="Troubleshooting uv4l streaming" class="md-nav__link">
    Troubleshooting uv4l streaming
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#uv4l-will-not-go-away" title="uv4l will not go away" class="md-nav__link">
    uv4l will not go away
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#manually-editing-user-config-json-files" title="Manually editing user config (json) files" class="md-nav__link">
    Manually editing user config (json) files
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#working-versions" title="Working versions" class="md-nav__link">
    Working versions
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../web-interface/" title="Web interface" class="md-nav__link">
      Web interface
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../wiring-behavior-box/" title="Wiring behavior box" class="md-nav__link">
      Wiring behavior box
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../wiring-scope/" title="Wiring scope" class="md-nav__link">
      Wiring scope
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../wiring-treadmill/" title="Wiring treadmill" class="md-nav__link">
      Wiring treadmill
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#common-errors" title="Common Errors" class="md-nav__link">
    Common Errors
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#oserror-errno-98-address-already-in-use" title="OSError: [Errno 98] Address already in use" class="md-nav__link">
    OSError: [Errno 98] Address already in use
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting-the-camera" title="Troubleshooting the camera" class="md-nav__link">
    Troubleshooting the camera
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bcamera-picamerammalerror-failed-to-enable-connection-out-of-resources" title="bCamera PiCameraMMALError: Failed to enable connection: Out of resources" class="md-nav__link">
    bCamera PiCameraMMALError: Failed to enable connection: Out of resources
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting-a-dht-temperaturehumidity-sensor" title="Troubleshooting a DHT temperature/humidity sensor" class="md-nav__link">
    Troubleshooting a DHT temperature/humidity sensor
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#converting-video-to-mp4" title="Converting video to mp4" class="md-nav__link">
    Converting video to mp4
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting-uv4l-streaming" title="Troubleshooting uv4l streaming" class="md-nav__link">
    Troubleshooting uv4l streaming
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#uv4l-will-not-go-away" title="uv4l will not go away" class="md-nav__link">
    uv4l will not go away
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#manually-editing-user-config-json-files" title="Manually editing user config (json) files" class="md-nav__link">
    Manually editing user config (json) files
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#working-versions" title="Working versions" class="md-nav__link">
    Working versions
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>Troubleshooting</h1>
                
                <p>The first thing to check is the PiE server log. The log can be viewed in many ways,</p>
<ol>
<li>From the web interface</li>
<li>By running the PiE server on the command line with <code>./pie run</code></li>
<li>By directly viewing the log file with <code>more ~/pie/pie_app/pie.log</code></li>
</ol>
<h2 id="common-errors">Common Errors</h2>
<h3 id="oserror-errno-98-address-already-in-use">OSError: [Errno 98] Address already in use</h3>
<p>This happens when you try and start the server but it is already running. Usually when it is running in the background and you run it again with <code>./pie run</code>. Just stop the server with <code>./pie stop</code> and then try again with <code>./pie run</code>.</p>
<h2 id="troubleshooting-the-camera">Troubleshooting the camera</h2>
<p>Capture a still image with the Pi camera with:</p>
<pre><code>raspistill -o test.jpg
</code></pre>

<p>If you get any errors then there is a problem with the Pi Camera.</p>
<p>Make sure the Pi Camera is activated.</p>
<pre><code># type this at a command prompt
sudo raspi-config

# select '5 Interface Options'
# select 'P1 Camera'
# Answer 'Yes' to question 'Would you like the camera interface to be enabled?'
</code></pre>

<h3 id="bcamera-picamerammalerror-failed-to-enable-connection-out-of-resources">bCamera PiCameraMMALError: Failed to enable connection: Out of resources</h3>
<p>If you receive this error in the web interface or PiE server log, it means the camera is in use by some other process. The Raspberry camera can only do one thing at a time, it can stream or record but not both at the same time. In addition, the camera can not record (or stream) in two different programs simultaneously.</p>
<p>Make sure other programs are not using the camera and try again. Rebooting with 'sudo reboot' usually does the trick unless these programs, like the PiE server, are set up to run at boot.</p>
<h2 id="troubleshooting-a-dht-temperaturehumidity-sensor">Troubleshooting a DHT temperature/humidity sensor</h2>
<p>Run the simplified code in the <a href="../testing/">testing/</a> folder. If you can't get a temperature/humidity reading with this code, it will not work within the PiE server.</p>
<p>Check the PiE server log (see above) and make sure the Adafruit DHT driver is installed and run when the PiE server is started. You should see entries in the PiE server log like this:</p>
<pre><code>[2018-10-14 09:53:59,596] {bTrial.py &lt;module&gt;:51} DEBUG - Loaded Adafruit_DHT
[2018-10-14 09:54:00,168] {bTrial.py __init__:178} DEBUG - starting temperature thread
[2018-10-14 09:54:00,172] {bTrial.py tempThread:918} INFO - tempThread() sensorTypeStr:AM2302 sensorType:22 pin:4
</code></pre>
<p>If the DHT driver is not installed, install it with <code>./install-dht</code>, restart the PiE server with <code>./pie restart</code>, and check the PiE server log again.</p>
<h2 id="converting-video-to-mp4">Converting video to mp4</h2>
<p>The PiE server uses <a href="https://libav.org/">libav (avconv)</a> to convert video from .h264 to .mp4. If libav (avconv) does not install during <code>~/pie/install-pie</code>, this conversion will not work.</p>
<h2 id="troubleshooting-uv4l-streaming">Troubleshooting uv4l streaming</h2>
<p>In rare instances the <a href="https://www.linux-projects.org/uv4l/">uv4l</a> streaming server does not stop properly. Streaming with uv4l runs at the system level and not in Python. As such, uv4l needs to be controlled via the command line.</p>
<pre><code>#list all uv4l processes
ps -aux | grep uv4l

# will yield something like
root     23117  9.8  1.3 140796 12312 ?        Ssl  20:34   0:02 uv4l --driver raspicam --auto-video_nr --encoding h264 --width 640 --height 480 --enable-server on
pi       23262  0.0  0.1   6644  1316 pts/1    S+   20:34   0:00 grep --color=auto uv4l

# kill uv4l with its process id (PID)
# '--' is needed to kill parent and child processes
sudo kill -- 23117

#check the uv4l process is no longer running
ps -aux | grep uv4l

# should yield
pi         674  0.0  0.1   6644  1320 pts/0    S+   21:06   0:00 grep --color=auto uv4l
</code></pre>

<h4 id="uv4l-will-not-go-away">uv4l will not go away</h4>
<p>Worst case senario is <code>ps -aux | grep uvl4</code> yields something like this</p>
<pre><code>root     23117 17.2  0.0      0     0 ?        Zsl  20:34   0:37 [uv4l] &lt;defunct&gt;
</code></pre>

<p>If you see the <code>&lt;defunct&gt;</code> then restart the Pi with <code>sudo reboot</code> and it should be fixed.</p>
<h2 id="manually-editing-user-config-json-files">Manually editing user config (json) files</h2>
<p>The PiE server comes with three default sets of options: Homecage, Scope, and Treadmill. There is an additional <code>User</code> configuration that can be edited manually to configure the PiE server.</p>
<p>To edit the <code>User</code> file, open <code>pie/pie_app/config/config_user.json</code> in the <a href="../config-folder">pie/pie_app/config/</a> folder. The format of the file is [json][json] and basically specifies key/value pairs. Do not add or remove any keys, just change their values. The json format is very strict, if there are any syntax errors, the file will not load and the PiE server will not run.</p>
<p>To check your work, use</p>
<pre><code>cd ~/pie/pie_app/config
cat config_user.json | python -m json.tool
</code></pre>

<p>If your edits are syntatically correct, this command will output the contents of the file. If you have created an error, they will be reported on the command line. For example, if your forget a comma  after <code>"enabled": true</code> like this</p>
<pre><code>        &quot;triggerIn&quot;: {
            &quot;enabled&quot;: true
            &quot;pin&quot;: 23,
            &quot;polarity&quot;: &quot;rising&quot;,
            &quot;pull_up_down&quot;: &quot;down&quot;
        },
</code></pre>

<p>You will get an error</p>
<pre><code>Expecting , delimiter: line 27 column 13 (char 648)
</code></pre>

<h2 id="working-versions">Working versions</h2>
<p>Here is a snapshot of versions for a working PiE server as of October 2018. As python packages are updated, things can potentially break.</p>
<pre><code>cd ~/pie
source pie_env/bin/activate # activate the Python3 virtual environment
pip freeze # print all the Phython packages and their versions

# use 'deactivate' to deactivate the Python3 virtual environmnet and return to the normal command prompt
</code></pre>

<pre><code># returns
click==6.7
dnspython==1.15.0
eventlet==0.24.1
Flask==1.0.2
Flask-Cors==3.0.6
Flask-SocketIO==3.0.1
greenlet==0.4.14
itsdangerous==0.24
Jinja2==2.10
MarkupSafe==1.0
monotonic==1.5
picamera==1.13
pigpio==1.40.post1
pkg-resources==0.0.0
pyserial==3.4
python-engineio==2.2.0
python-socketio==2.0.0
RPi.GPIO==0.6.3
six==1.11.0
Werkzeug==0.14.1
</code></pre>

<pre><code>python --version
</code></pre>

<pre><code># returns
Python 3.5.3
</code></pre>

<pre><code>cat /etc/os-release
</code></pre>

<pre><code># returns
PRETTY_NAME=&quot;Raspbian GNU/Linux 9 (stretch)&quot;
NAME=&quot;Raspbian GNU/Linux&quot;
VERSION_ID=&quot;9&quot;
VERSION=&quot;9 (stretch)&quot;
ID=raspbian
ID_LIKE=debian
</code></pre>

<pre><code>uname -a
</code></pre>

<pre><code># returns
Linux pi15 4.14.52-v7+ #1123 SMP Wed Jun 27 17:35:49 BST 2018 armv7l GNU/Linux
</code></pre>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
      
    </div>
    
      <script src="../assets/javascripts/application.6cdc17f0.js"></script>
      
      <script>app.initialize({version:"0.17.2",url:{base:".."}})</script>
      
        <script src="../javascripts/extra.js"></script>
      
    
    
      
    
  </body>
</html>