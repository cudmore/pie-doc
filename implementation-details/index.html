
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Raspberry Pi Controlled Experiment (PiE)">
      
      
        <meta name="author" content="Robert H Cudmore">
      
      
      <link rel="icon" href="../img/icons/video-camera-blue.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-8.5.10">
    
    
      
        <title>Implementation details - PiE Docs</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.975780f9.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.2505c338.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="None" data-md-color-accent="None">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#raspberry-pi" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="PiE Docs" class="md-header__button md-logo" aria-label="PiE Docs" data-md-component="logo">
      
  <img src="../img/icons/video-camera-blue.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            PiE Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Implementation details
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/cudmore/pie" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    PiE Repository
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="PiE Docs" class="md-nav__button md-logo" aria-label="PiE Docs" data-md-component="logo">
      
  <img src="../img/icons/video-camera-blue.png" alt="logo">

    </a>
    PiE Docs
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/cudmore/pie" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    PiE Repository
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../images/" class="md-nav__link">
        Image Gallery
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Install
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Install" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Install
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../install-buster/" class="md-nav__link">
        Preparing a Raspberry Pi
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../install/" class="md-nav__link">
        Install the PiE server
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../web-interface/" class="md-nav__link">
        Web Interface
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../commander/" class="md-nav__link">
        Commander
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../video-annotate/" class="md-nav__link">
        Video Annotate
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../parts/" class="md-nav__link">
        Parts List
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" type="checkbox" id="__nav_8" >
      
      
      
      
        <label class="md-nav__link" for="__nav_8">
          Wiring
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Wiring" data-md-level="1">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          Wiring
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../wiring-behavior-box/" class="md-nav__link">
        Behavior Box
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../wiring-scope/" class="md-nav__link">
        Scope
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../wiring-treadmill/" class="md-nav__link">
        Treadmill
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../troubleshooting/" class="md-nav__link">
        Troubleshooting
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_10" type="checkbox" id="__nav_10" >
      
      
      
      
        <label class="md-nav__link" for="__nav_10">
          Extras
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Extras" data-md-level="1">
        <label class="md-nav__title" for="__nav_10">
          <span class="md-nav__icon md-icon"></span>
          Extras
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../file-server/" class="md-nav__link">
        File Server
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mount-usb-drive/" class="md-nav__link">
        Mount USB Drive
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rest-interface/" class="md-nav__link">
        Rest Interface
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../trial-file/" class="md-nav__link">
        Trial File
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../gpio-timing/" class="md-nav__link">
        GPIO Timing
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Implementation details
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Implementation details
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#raspberry-pi" class="md-nav__link">
    Raspberry Pi
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#back-end" class="md-nav__link">
    Back End
  </a>
  
    <nav class="md-nav" aria-label="Back End">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#web-server" class="md-nav__link">
    Web server
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#python-class-library" class="md-nav__link">
    Python class library
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#front-end" class="md-nav__link">
    Front End
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#admin-server" class="md-nav__link">
    Admin server
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#commander-server" class="md-nav__link">
    Commander server
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#components" class="md-nav__link">
    Components
  </a>
  
    <nav class="md-nav" aria-label="Components">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#uv4l" class="md-nav__link">
    uv4l
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#avconv" class="md-nav__link">
    avconv
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dht-sensors" class="md-nav__link">
    DHT sensors
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#documentation" class="md-nav__link">
    Documentation
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../release-notes/" class="md-nav__link">
        Release Notes
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../about/" class="md-nav__link">
        About
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#raspberry-pi" class="md-nav__link">
    Raspberry Pi
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#back-end" class="md-nav__link">
    Back End
  </a>
  
    <nav class="md-nav" aria-label="Back End">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#web-server" class="md-nav__link">
    Web server
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#python-class-library" class="md-nav__link">
    Python class library
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#front-end" class="md-nav__link">
    Front End
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#admin-server" class="md-nav__link">
    Admin server
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#commander-server" class="md-nav__link">
    Commander server
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#components" class="md-nav__link">
    Components
  </a>
  
    <nav class="md-nav" aria-label="Components">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#uv4l" class="md-nav__link">
    uv4l
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#avconv" class="md-nav__link">
    avconv
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dht-sensors" class="md-nav__link">
    DHT sensors
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#documentation" class="md-nav__link">
    Documentation
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>Implementation details</h1>

<p>Once running, the PiE server should be simple to use and only requires interaction with its <a href="../web-interface/">web interface</a>. Yet, for this simple system to work, a number of independent components must each work and must communicate with each other. As is often the case, the details in creating a simple system is complex.</p>
<p>What follows is a description of the different pieces of the PiE server with links to the source code and the components that are used.</p>
<h2 id="raspberry-pi">Raspberry Pi</h2>
<p>At its core, this system requires a functioning Raspberry Pi running the <a href="https://www.raspberrypi.org/documentation/raspbian/">Raspbian</a> operating system. Because this is an intentionally stripped down system, some things are not installed out of the box like <a href="../mount-usb-drive/">mounting a USB drive</a>. On the other hand, this is a full-fledged <a href="https://www.debian.org/">Debian Linux</a> system so you can activate powerful features such as a <a href="../file-server/">file-server</a>.</p>
<h2 id="back-end">Back End</h2>
<h3 id="web-server">Web server</h3>
<ul>
<li><a href="https://github.com/cudmore/pie/blob/master/pie_app/treadmill_app.py">pie_app/treadmill_app.py</a> - This code creates the main PiE web server (running on port 5010) using <a href="http://flask.pocoo.org/">Flask</a> and is the main starting point to run the PiE server. It acts as a connection between web requests (URLs) and the backend by processing each incoming URL and calling the appropriate backend code in <a href="https://github.com/cudmore/pie/blob/master/pie_app/treadmill.py">pie_app/treadmill.py</a>.</li>
</ul>
<h3 id="python-class-library">Python class library</h3>
<ul>
<li>
<p><a href="https://github.com/cudmore/pie/blob/master/pie_app/treadmill.py">pie_app/treadmill.py</a> - Wrapper class around <a href="https://github.com/cudmore/pie/blob/master/pie_app/bTrial.py">pie_app/bTrial.py</a> to implement specifics of the PiE server beyond what bTrial provides. This mainly includes some logic using web sockets, in particular <a href="https://flask-socketio.readthedocs.io/en/latest/">flask-socketio</a>, for bi-directional communication from the browser to the backend and from the backend to the browser.</p>
</li>
<li>
<p><a href="https://github.com/cudmore/pie/blob/master/pie_app/bTrial.py">pie_app/bTrial.py</a> - Main catch-all class that implements the logic of a trial based experiment. When it is instantiated, it creates a number of background threads to control independent processes including: GPIO pins, the timing of automatic lights, temperature/humidity readings, and serial communication with a Teensy. The use of background threads is important, they are run in parallel to the main code (utilizing the Raspberry Pis 4-core CPU) and allow everything to run smoothly with minimal <a href="https://en.wikipedia.org/wiki/Blocking_(computing)">blocking</a>. Once running, bTrial receives commands from the web interface in treadmill_app.py to take actions like: changing/loading/saving user configurations, starting/stopping video recording and streaming, setting GPIO pins, and performing serial communication with a Teensy.</p>
</li>
<li>
<p><a href="https://github.com/cudmore/pie/blob/master/pie_app/bCamera.py">pie_app/bCamera.py</a> - Code to control a Raspberry Pi camera using the <a href="https://picamera.readthedocs.io">piCamera</a> Python library. This is where both video recording and streaming with uv4l is started and stopped. This also contains a background thread that uses avconv to convert .h264 video saved by the camera into .mp4.</p>
</li>
<li>
<p><a href="https://github.com/cudmore/pie/blob/master/pie_app/bPins.py">pie_app/bPins.py</a> - Code to control the Raspberry Pi GPIO pins using either <a href="https://pypi.org/project/RPi.GPIO/">RPi.GPIO</a> or the <a href="http://abyz.me.uk/rpi/pigpio/">pigpio</a> daemon. This is where the PiE server can change GPIO pins and where code is triggered when a pin changes from an external source like a microscope.</p>
</li>
<li>
<p><a href="https://github.com/cudmore/pie/blob/master/pie_app/bSerial.py">pie_app/bSerial.py</a> - Code to communicate with an Arduino/Teensy microcontroller over a serial connection (via a USB cable). This is basically to get and set parameters as well as starting/stopping a trial on the Teensy. It works as a background thread instantiated by bTrial and then sits silently waiting for commands to be inserted into a queue. This is not used to program the Teensy, that is handled by <a href="https://github.com/cudmore/pie/tree/master/platformio">platformio</a></p>
</li>
<li>
<p><a href="https://github.com/cudmore/pie/blob/master/pie_app/bUtil.py">pie_app/bUtil.py</a> - Implements basic utility functions like fetching the system date/time, determining the amount of drive space remaining, and getting the IP address and hostname.</p>
</li>
<li>
<p><a href="https://github.com/cudmore/pie/tree/master/pie_app/config">pie_app/config</a> - Text files written in <a href="https://www.json.org/">json</a> that provides human editable configuration options for the server. These json files are loaded when the server starts and are saved when the user saves from the web interface. These json files contain all the configurable options provided by the PiE server, things like the default state of GPIO pins and configurations like the video recording duration and number of repeats.</p>
</li>
</ul>
<h2 id="front-end">Front End</h2>
<p>The backend web server in <a href="https://github.com/cudmore/pie/blob/master/pie_app/treadmill_app.py">pie_app/treadmill_app.py</a> delivers .html pages which have logic driven by Javascript (.js) and formatted with .css.</p>
<ul>
<li>
<p><a href="https://github.com/cudmore/pie/blob/master/pie_app/templates/index.html">pie_app/templates/index.html</a> - Main web interface written in <a href="https://en.wikipedia.org/wiki/HTML">html</a>, uses <a href="https://www.javascript.com/">Javascript</a> and the Javascript <a href="https://angularjs.org/">Angular</a> library to provide dynamic and real-time content.</p>
</li>
<li>
<p><a href="https://github.com/cudmore/pie/blob/master/pie_app/static/treadmill.js">pie_app/static/treadmill.js</a> - <a href="https://www.javascript.com/">Javascript</a> code that implementes the logic of the web interface. Has functions that get called when user is clicking or entering parameter values. Also has function to talk to <a href="https://github.com/cudmore/pie/blob/master/pie_app/treadmill_app.py">treadmill_app.py</a> web server via a <a href="https://en.wikipedia.org/wiki/Representational_state_transfer">REST</a> interface. This is not standard Javascript but is using the <a href="https://angularjs.org/">Angular</a> library.</p>
</li>
<li>
<p><a href="https://github.com/cudmore/pie/blob/master/pie_app/static/treadmill.css">pie_app/static/treadmill.css</a> - A <a href="https://www.w3schools.com/css/css_intro.asp">Cascading Style Sheet (css)</a> text file that describes the precise visual layout of the web pages.</p>
</li>
<li>
<p>Miscellaneous - Each webpage served by the PiE server needs a .html file and often uses a Javascript .js file to control the logic of user interaction. This includes <a href="https://github.com/cudmore/pie/blob/master/pie_app/templates/videolist.html">videolist.html</a> which serves a list of video files saved on the Pi and <a href="https://github.com/cudmore/pie/blob/master/pie_app/templates/environment.html">environment.html</a> along with <a href="https://github.com/cudmore/pie/blob/master/pie_app/static/environment.js">environment.js</a> which controls the web based plotting of temperature and humidity.</p>
</li>
</ul>
<h2 id="admin-server">Admin server</h2>
<p>The <a href="https://github.com/cudmore/pie/tree/master/admin_app">admin_app</a> contains a second web server (running on port 5011) allowing the main PiE server (running on port 5010) to be restarted and the Raspberry Pi to be rebooted. This is necessary to allow all this to happen from the PiE <a href="../web-interface/">web interface</a>. This admin app is automatically installed when the PiE server is installed with <code>./install-pie</code> and should not need further tweaking.</p>
<h2 id="commander-server">Commander server</h2>
<p>The <a href="https://github.com/cudmore/pie/tree/master/commander_app">commander_app</a> creates a web interface (running on port 8000) to control any number of PiE servers (on port 5010) running on different Raspberry Pis. The commander server runs completely independent of the PiE server and can be installed on its own dedicated Raspberry Pi or one that is already running the PiE server. See the <a href="../commander/">commander</a> documentation for more details.</p>
<p><strong>Note..</strong> In a near future version, the commander will be able to run on any other machine including macOS and Microsoft Windows computers.</p>
<h2 id="components">Components</h2>
<h3 id="uv4l">uv4l</h3>
<p>The <a href="https://www.linux-projects.org/uv4l/">uv4l</a> system is used to streaming video from the camera to a web browser. This is a system wide program and is controlled from bCamera using bash script in <a href="https://github.com/cudmore/pie/tree/master/pie_app/bin">pie_app/bin</a>.</p>
<h3 id="avconv">avconv</h3>
<p>The <a href="https://libav.org/avconv.html">avconv</a> package (also known as libav) is used to convert .h264 files saved by the camera to .mp4. This is a system wide program and is controlled from bCamera using bash script in <a href="https://github.com/cudmore/pie/tree/master/pie_app/bin">pie_app/bin</a>.</p>
<h3 id="dht-sensors">DHT sensors</h3>
<p>Readings from AM2302 and DHT22 temperature/humidity sensors requires the Adafruit Python library <a href="https://github.com/adafruit/Adafruit_Python_DHT">Adafruit_Python_DHT</a>. Readings are implemented in a background task in bTrial.</p>
<h2 id="documentation">Documentation</h2>
<p>Last but not least, this website is written in <a href="https://en.wikipedia.org/wiki/Markdown">markdown</a>. The markdown and a description of the contents using <a href="http://yaml.org/">yaml</a> are brought together, compiled, and a static site is generated by <a href="http://www.mkdocs.org/">mkdocs</a>. The final layout is controlled by an mkdocs theme called <a href="https://squidfunk.github.io/mkdocs-material/">material</a>. All of this is then pushed to <a href="http://github.com">Github</a> which serves this website fast and reliable.</p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant"], "search": "../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.5a2dcb6a.min.js"></script>
      
        <script src="../javascripts/extra.js"></script>
      
    
    
  </body>
</html>