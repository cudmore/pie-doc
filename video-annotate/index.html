
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Raspberry Pi Controlled Experiment (PiE)">
      
      
        <meta name="author" content="Robert H Cudmore">
      
      
      <link rel="icon" href="../img/icons/video-camera-blue.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-8.5.10">
    
    
      
        <title>Video Annotate - PiE Docs</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.975780f9.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.2505c338.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="None" data-md-color-accent="None">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#install" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="PiE Docs" class="md-header__button md-logo" aria-label="PiE Docs" data-md-component="logo">
      
  <img src="../img/icons/video-camera-blue.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            PiE Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Video Annotate
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/cudmore/pie" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    PiE Repository
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="PiE Docs" class="md-nav__button md-logo" aria-label="PiE Docs" data-md-component="logo">
      
  <img src="../img/icons/video-camera-blue.png" alt="logo">

    </a>
    PiE Docs
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/cudmore/pie" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    PiE Repository
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../images/" class="md-nav__link">
        Image Gallery
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Install
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Install" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Install
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../install-buster/" class="md-nav__link">
        Preparing a Raspberry Pi
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../install/" class="md-nav__link">
        Install the PiE server
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../web-interface/" class="md-nav__link">
        Web Interface
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../commander/" class="md-nav__link">
        Commander
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Video Annotate
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Video Annotate
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#install" class="md-nav__link">
    Install
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#directions-for-using-videoannotate-for-behavior-scoring" class="md-nav__link">
    Directions for Using VideoAnnotate for Behavior Scoring
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#keyboard-commands" class="md-nav__link">
    Keyboard commands
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#menus" class="md-nav__link">
    Menus
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#saving-events" class="md-nav__link">
    Saving events
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#analysis" class="md-nav__link">
    Analysis
  </a>
  
    <nav class="md-nav" aria-label="Analysis">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#event-analysis" class="md-nav__link">
    Event Analysis
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#blinding-analysis" class="md-nav__link">
    Blinding analysis
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#blind-scoring" class="md-nav__link">
    Blind Scoring
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#options-file" class="md-nav__link">
    Options file
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#known-bugs" class="md-nav__link">
    Known bugs
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#to-do-important" class="md-nav__link">
    To Do (important)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#to-do" class="md-nav__link">
    To Do
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#to-do-done" class="md-nav__link">
    To Do (done)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting" class="md-nav__link">
    Troubleshooting
  </a>
  
    <nav class="md-nav" aria-label="Troubleshooting">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#standalone-app" class="md-nav__link">
    Standalone app
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-from-source" class="md-nav__link">
    Running from source
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#old-install" class="md-nav__link">
    old - Install
  </a>
  
    <nav class="md-nav" aria-label="old - Install">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#old-install-using-install-player-script" class="md-nav__link">
    old - Install - Using 'install-player' script
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#old-install-using-requirements-file" class="md-nav__link">
    old - Install - Using requirements file
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#old-install-step-by-step" class="md-nav__link">
    old - Install - Step By Step
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../parts/" class="md-nav__link">
        Parts List
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" type="checkbox" id="__nav_8" >
      
      
      
      
        <label class="md-nav__link" for="__nav_8">
          Wiring
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Wiring" data-md-level="1">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          Wiring
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../wiring-behavior-box/" class="md-nav__link">
        Behavior Box
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../wiring-scope/" class="md-nav__link">
        Scope
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../wiring-treadmill/" class="md-nav__link">
        Treadmill
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../troubleshooting/" class="md-nav__link">
        Troubleshooting
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_10" type="checkbox" id="__nav_10" >
      
      
      
      
        <label class="md-nav__link" for="__nav_10">
          Extras
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Extras" data-md-level="1">
        <label class="md-nav__title" for="__nav_10">
          <span class="md-nav__icon md-icon"></span>
          Extras
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../file-server/" class="md-nav__link">
        File Server
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mount-usb-drive/" class="md-nav__link">
        Mount USB Drive
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rest-interface/" class="md-nav__link">
        Rest Interface
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../trial-file/" class="md-nav__link">
        Trial File
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../gpio-timing/" class="md-nav__link">
        GPIO Timing
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../implementation-details/" class="md-nav__link">
        Implementation details
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../release-notes/" class="md-nav__link">
        Release Notes
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../about/" class="md-nav__link">
        About
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#install" class="md-nav__link">
    Install
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#directions-for-using-videoannotate-for-behavior-scoring" class="md-nav__link">
    Directions for Using VideoAnnotate for Behavior Scoring
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#keyboard-commands" class="md-nav__link">
    Keyboard commands
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#menus" class="md-nav__link">
    Menus
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#saving-events" class="md-nav__link">
    Saving events
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#analysis" class="md-nav__link">
    Analysis
  </a>
  
    <nav class="md-nav" aria-label="Analysis">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#event-analysis" class="md-nav__link">
    Event Analysis
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#blinding-analysis" class="md-nav__link">
    Blinding analysis
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#blind-scoring" class="md-nav__link">
    Blind Scoring
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#options-file" class="md-nav__link">
    Options file
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#known-bugs" class="md-nav__link">
    Known bugs
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#to-do-important" class="md-nav__link">
    To Do (important)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#to-do" class="md-nav__link">
    To Do
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#to-do-done" class="md-nav__link">
    To Do (done)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting" class="md-nav__link">
    Troubleshooting
  </a>
  
    <nav class="md-nav" aria-label="Troubleshooting">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#standalone-app" class="md-nav__link">
    Standalone app
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-from-source" class="md-nav__link">
    Running from source
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#old-install" class="md-nav__link">
    old - Install
  </a>
  
    <nav class="md-nav" aria-label="old - Install">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#old-install-using-install-player-script" class="md-nav__link">
    old - Install - Using 'install-player' script
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#old-install-using-requirements-file" class="md-nav__link">
    old - Install - Using requirements file
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#old-install-step-by-step" class="md-nav__link">
    old - Install - Step By Step
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>Video Annotate</h1>

<p>Video annotate is a desktop application that provides a simple to use point and click interface to annotatate behavioral events in video files.</p>
<p>This is in its own Github repository named <a href="https://github.com/cudmore/pie-analysis">Pie-Analysis</a></p>
<p>Example screenshot of editing a video 'chunk'. All events within the chunk are shown schematically below the video. The number in the event is the event type (1..9). Selecting an event will snap the video to the first frame of the event. In this case, the 4th event is selected. Once selected the event start/stop frame can be edited with keyboard 'f' and 'l'.</p>
<p><img alt="VideoAnnotate GUI" src="../img/video-annotate/v3-interface.png" /></p>
<h2 id="install">Install</h2>
<p>Clone the source</p>
<pre><code>git clone https://github.com/cudmore/pie-analysis.git
</code></pre>
<p>Make a Python virtual environment</p>
<pre><code>python -m venv video-annotate
source video-annotate/bin/activate
</code></pre>
<p>Install the video-player requirements</p>
<pre><code>cd video-player
pip install -r requirements.txt
</code></pre>
<p>Run desktop GUI of video player</p>
<pre><code>python src/VideoApp.py
</code></pre>
<h2 id="directions-for-using-videoannotate-for-behavior-scoring">Directions for Using VideoAnnotate for Behavior Scoring</h2>
<ol>
<li>Open VideoAnnotate and under File, select the folder with the video files to be analyzed. </li>
<li>Click “generate chunks”. </li>
<li>Change the piece duration (if chunks need to be selected evenly across the video file), duration of the chunks, and number of chunks per file.</li>
<li>Navigate to the folder on the hard drive, duplicate the chunks file and name the copy “randomChunks.txt”</li>
<li>Quit VideoAnnotate and relaunch the application.</li>
<li>Select the relevant folder of videos and under the Window menu, see that “Blind Interface” is selected. </li>
<li>The chunks will appear starting at 0/1234 (1234 will be the total number of chunks across the entire folder you selected). </li>
<li>Use the space bar to play the chunk #0, and at the occurrence of a behavior of interest, press the computer key 1-9 corresponding to the specific behavior being scored. </li>
<li>Click the arrow for Next Chunk and continue doing so until scoring is complete.</li>
<li>If duration of behaviors is needed, click the number corresponding to the specific behavior and use the “f” and “l” keys to set the duration of the first and last frames during which the behavior occurs. </li>
<li>When scoring is complete, VideoAnnotate will have written csv files into the folder containing the video files. Each csv can be read into excel, R, MatLab, or whatever the user’s choice of analysis software may be. </li>
</ol>
<h2 id="keyboard-commands">Keyboard commands</h2>
<p>Controlling video</p>
<table>
<thead>
<tr>
<th>Keyboard</th>
<th>Action</th>
</tr>
</thead>
<tbody>
<tr>
<td>space</td>
<td>play/pause</td>
</tr>
<tr>
<td>left-arrow</td>
<td>Move backwards in video</td>
</tr>
<tr>
<td>rigth-arrow</td>
<td>Move forwards in video</td>
</tr>
<tr>
<td>shift + left arrow</td>
<td>Larger move backward in video</td>
</tr>
<tr>
<td>shift + right arrow</td>
<td>Larger move forward in video</td>
</tr>
<tr>
<td>+</td>
<td>Play video faster</td>
</tr>
<tr>
<td>-</td>
<td>Play video slower</td>
</tr>
</tbody>
</table>
<p>Editing events</p>
<table>
<thead>
<tr>
<th>Keyboard</th>
<th>Action</th>
</tr>
</thead>
<tbody>
<tr>
<td>1..9</td>
<td>Create new event at current frame</td>
</tr>
<tr>
<td>f</td>
<td>Set first frame of selected event</td>
</tr>
<tr>
<td>l</td>
<td>Set last frame of selected event</td>
</tr>
<tr>
<td>n</td>
<td>Set note of current selected event</td>
</tr>
</tbody>
</table>
<p>Chunks</p>
<table>
<thead>
<tr>
<th>Keyboard</th>
<th>Action</th>
</tr>
</thead>
<tbody>
<tr>
<td>[</td>
<td>Previous Chunk</td>
</tr>
<tr>
<td>]</td>
<td>Next Chunk</td>
</tr>
</tbody>
</table>
<p>There are currently 9 event types corresponding to keyboard 1, 2, 3, 4, 5, 6, 7, 8, 9.</p>
<h2 id="menus">Menus</h2>
<p><strong>File</strong></p>
<ul>
<li><strong>Open Folder...</strong> - Open a folder of video files. Video files must be mp4.</li>
<li><strong>Open Random Chunks...</strong> - Open a random chunks file. See <a href="#blind_scoring">Blind scoring</a>.</li>
<li><strong>Save Options</strong> - Save options to a file. Options will be reloaded next time program runs. See <a href="#options_file">Options file</a>.</li>
<li><strong>Quit</strong> - Quit the video player. Options are automatically saved before quit.</li>
</ul>
<p><strong>Window</strong></p>
<p>Toggle interface on/off for: video files, events, video feedback, and chunks.</p>
<h2 id="saving-events">Saving events</h2>
<p>All events are automatically saved in a text file (.txt) with the same base name as the video file. One events .txt file per video file. The events file is saved when new events are created or edited (first/last frame, note, file video note).</p>
<p>First line in events file is comma separated list of name=value pairs describing the associated video. Second line is column headers. Remaining lines in file are event with one event per line. For example, an events file with three events would look like this:</p>
<pre><code>#
path=/Users/cudmore/Dropbox/PiE/video/1-homecage-movie.mp4,fileName=1-homecage-movie.mp4,width=640.0,height=480.0,aspectRatio=0.75,fps=15.0,numFrames=4500,numSeconds=300.0,numEvents=22,videoFileNote=,
index,path,cSeconds,cDate,cTime,typeNum,typeStr,frameStart,frameStop,numFrames,sStart,sStop,numSeconds,chunkIndex,note,
0,/Users/cudmore/Dropbox/PiE/video/1-homecage-movie.mp4,1543552305.756366,2018-11-29,23:31:45,1,a,2468,,None,164.53,None,None,4,,,
1,/Users/cudmore/Dropbox/PiE/video/1-homecage-movie.mp4,1543552306.0374012,2018-11-29,23:31:46,2,b,2468,,None,164.53,None,None,4,,,
2,/Users/cudmore/Dropbox/PiE/video/1-homecage-movie.mp4,1543552306.435797,2018-11-29,23:31:46,3,c,2473,,None,164.87,None,None,4,,,
3,/Users/cudmore/Dropbox/PiE/video/1-homecage-movie.mp4,1543552306.8971589,2018-11-29,23:31:46,4,d,2479,,None,165.27,None,None,4,,,
</code></pre>
<h2 id="analysis">Analysis</h2>
<h3 id="event-analysis">Event Analysis</h3>
<ul>
<li>See <a href="https://github.com/cudmore/pie-analysis/blob/master/video-player/analysis/eventAnalysis.ipynb">Analysis/eventAnalysis</a>.</li>
<li>For each file, sum duration (sec) of each event type (1..9)</li>
<li>flag events that have start/stop frame out of order</li>
<li>flag events that overlap with previous event (if previous has duration)</li>
<li>flag events outside of a chunk</li>
</ul>
<h3 id="blinding-analysis">Blinding analysis</h3>
<ul>
<li>Make plot of chunks with each file in a list of files. See <a href="https://github.com/cudmore/pie-analysis/blob/master/video-player/analysis/chunkAnalysis.ipynb">Analysis/chunkAnalysis</a>.</li>
</ul>
<p><a name="blind_scoring"></a></p>
<h2 id="blind-scoring">Blind Scoring</h2>
<p><IMG SRC="../img/video-annotate/chunks-interface.png" width=600></p>
<table>
<thead>
<tr>
<th>Button</th>
<th>Action</th>
</tr>
</thead>
<tbody>
<tr>
<td>&lt;</td>
<td>Go to previous chunk (keyboard '[')</td>
</tr>
<tr>
<td>|&lt;</td>
<td>Go to start of current chunk</td>
</tr>
<tr>
<td>&gt;</td>
<td>Go to next chunk (keyboard ']')</td>
</tr>
<tr>
<td>Go To</td>
<td>Go to chunk number specified in the edit/spin box.</td>
</tr>
<tr>
<td>Limit Video Controls</td>
<td>Limit the video frame slider and all video controls (including keyboard) to stay within the current chunk. In addition, when checked, the event list will only show events within the current chunk.</td>
</tr>
</tbody>
</table>
<p>Blind scoring is done with a user created 'chunks' file. Once created, blinding is achieved by stepping through a number of (random) video chunks of a specified length.</p>
<p>Use the following code to generate a chunks file for a folder of video files. Once created, rename the output file to 'randomChunks.txt' and it will automatically be loaded when the folder of video is loaded into the video-player.</p>
<pre><code>    # full path to your video folder
    path = '/Users/cudmore/Dropbox/PiE/video'

    chunks = bChunk(path)

    pieceDurationSeconds = 10 * 60 # seconds
    chunkDurationSeconds = 10 # seconds
    chunksPerFile = 30
    outFile = chunks.generate(pieceDurationSeconds, chunkDurationSeconds, chunksPerFile)
</code></pre>
<p>Blinding Algorithm</p>
<ul>
<li><strong>video file duration (30 min)</strong> </li>
<li><strong>pieceDur (10 min)</strong> gives us numPieces = dur / pieceDur</li>
<li><strong>totalNumChunks (30)</strong> is total number of chunks for one video</li>
<li><strong>chunkDur (10 sec)</strong> is duration of each chunk</li>
<li>split video into a large number of chunks numChunks = (dur/chunkDur)</li>
<li>partition video into a number of 'pieces' numPieces = (dur/pieceDur)</li>
<li>chunksPerPiece = totalNumChunks/numPieces</li>
<li>for each 'piece', randomly choose chunksPerPiece without replacement. Can do this by stepping through all chunks and only considering chunks with a piece using chunksPerPiece.</li>
</ul>
<p>Here is an example of the results of the blinding algorithm for 6 video files, 30 chunks each. Each colored symbol is a different random chunk (duration 10 sec) and the color scale shows the order the chunks are visited. There are 180 chunks spread across the 6 files.</p>
<p><IMG src="../img/video-annotate/chunk-order.png" width=700></p>
<p>Blinding file format</p>
<ul>
<li>params: dict of parameters used to generate random chunks</li>
<li>chunkDurationSeconds:</li>
<li>chunksPerFile:</li>
<li>pieceDurationSeconds:</li>
<li>generated:</li>
<li>chunkOrder: integer list of random chunk order</li>
<li>chunks: dict list of chunks</li>
</ul>
<p>chunks</p>
<pre><code>        {
            &quot;index&quot;: 0,
            &quot;numFrames&quot;: 299,
            &quot;path&quot;: &quot;/Users/cudmore/Dropbox/PiE/scrambled/s_1831.mp4&quot;,
            &quot;piece&quot;: 0,
            &quot;randomIndex&quot;: 55,
            &quot;startFrame&quot;: 5083,
            &quot;stopFrame&quot;: 5381
        },
        {
            &quot;index&quot;: 1,
            &quot;numFrames&quot;: 299,
            &quot;path&quot;: &quot;/Users/cudmore/Dropbox/PiE/scrambled/s_1831.mp4&quot;,
            &quot;piece&quot;: 0,
            &quot;randomIndex&quot;: 29,
            &quot;startFrame&quot;: 11362,
            &quot;stopFrame&quot;: 11660
        },
        {
            &quot;index&quot;: 2,
            &quot;numFrames&quot;: 299,
            &quot;path&quot;: &quot;/Users/cudmore/Dropbox/PiE/scrambled/s_1831.mp4&quot;,
            &quot;piece&quot;: 0,
            &quot;randomIndex&quot;: 16,
            &quot;startFrame&quot;: 13156,
            &quot;stopFrame&quot;: 13454
        },
</code></pre>
<p><a name="options_file"></a></p>
<h2 id="options-file">Options file</h2>
<p>Interface options can be saved with menu 'File - Save Options'. Options are also saved each time the program is quit with 'File - Quit'.</p>
<p>The options are saved in a json file 'options.json' and can be manually edited. By manually editing the 'options.json' file, mappings between event numbers 1..9 and names can be specified. In addition, the duration the video is advanced/reversed with either the keyboard or video control buttons can be set with 'smallSecondsStep' and 'largeSecondsStep'.</p>
<pre><code>{
    &quot;appWindowGeometry&quot;: &quot;1035x698&quot;,
    &quot;eventTypes&quot;: {
        &quot;1&quot;: &quot;a&quot;,
        &quot;2&quot;: &quot;b&quot;,
        &quot;3&quot;: &quot;c&quot;,
        &quot;4&quot;: &quot;d&quot;,
        &quot;5&quot;: &quot;e&quot;,
        &quot;6&quot;: &quot;f&quot;,
        &quot;7&quot;: &quot;g&quot;,
        &quot;8&quot;: &quot;h&quot;,
        &quot;9&quot;: &quot;i&quot;
    },
    &quot;fpsIncrement&quot;: 5,
    &quot;smallSecondsStep&quot;: 10,
    &quot;largeSecondsStep&quot;: 60,
    &quot;showVideoFiles&quot;: true,
    &quot;showEvents&quot;: true,
    &quot;showRandomChunks&quot;: true,
    &quot;showVideoFeedback&quot;: true,
    &quot;videoFileSash&quot;: 200,
    &quot;eventSash&quot;: 400,
    &quot;lastPath&quot;: &quot;/Users/cudmore/Dropbox/PiE/video&quot;
}
</code></pre>
<h2 id="known-bugs">Known bugs</h2>
<ul>
<li>[fixed] Has some problems when it reaches end of file.</li>
<li>[fixed] Resizing window will sometimes cause a crash.</li>
<li>Check that avconv (used by PiE server on Pi) always generates valid mp4 files. See <a href="https://trac.ffmpeg.org/ticket/7365">here</a>. In at least one file, getting errors like 'Invalid NAL unit size' and 'Error splitting the input into NAL'. Maybe save original .h264 on Pi so we can convert later if neccessary.</li>
</ul>
<h2 id="to-do-important">To Do (important)</h2>
<ul>
<li>Add keys to set event 1..9 to preferences</li>
<li>[done] Implement single menu to turn blinding on/off</li>
<li>[bug] turning blinding on, the video stream is not paused???</li>
<li>scrolling up/down with arrow keys through video file list is NOT updating to next video. Clicking in list DOES work.</li>
<li>When starting app and chunk file is loaded, make sure we are in chunk 0. When user first clicks 'limit', we need to be in a chunk!!!</li>
<li>Clicking on a chunk (gray bar) should select chunk (in chunk view).</li>
<li>Selecting event in event list should highlight event in event canvas.</li>
<li>Streamline interface for blinding. Make a system where when handed to a scorer, they can not activate non-blinded interface (they are locked into blinding). Try and add a password to switch between one and the other.</li>
<li>Update numEvents in video list as we add/delete events</li>
<li>Make menu interface to create random chunks file from folder. So we can do it in stand-alone app</li>
<li>Add dIndex to events so we can always show events in list with 'index' column as 1,2,3,...</li>
<li>When editing chunks, do not allow video list selection</li>
<li>Recalculate chunkIndex when setting event startFrame with keyboard 'f'.</li>
<li>[hard] switch event list interface when editing chunks. Show frame start/stop relative to start of current chunk</li>
</ul>
<h2 id="to-do">To Do</h2>
<ul>
<li>[done?] Fix chunk interface, it is remembering pointers to old chunk file</li>
<li>Implement options dialog to set small/big keyboard steps (Seconds) </li>
<li>Finish 'about dialog'</li>
<li>Make fps a spin box to easily increase/descrease.</li>
<li>[solved] Highlight most recent event in list as video is played. Need to sort by startFrame.</li>
<li>[solved] Add option to warn when event frame start/stop is out of order, e.g. frameStart&gt;frameStop.</li>
<li>Add note to video file by putting it in event list header. Finish 'right-click' popup menu in video list.</li>
<li>[bug] Make sure toggle of video file and event list do not trash interface on next run. Need to add code to HIDE video and event list, currently setting sashpos==0 (remove this).</li>
<li>[bug] When increasing/decreasing fps with +/-, sometimes can not get back to orignal fps. Fix this. This is now fixed but minimum fps is no longer 1 fps.</li>
<li>[big idea - done] Make a visual bar for each video file showing: duration (black) overlaid .with position of chunks (gray), and position of events (bright colors). </li>
</ul>
<h2 id="to-do-done">To Do (done)</h2>
<ul>
<li>[done] In event tree, select and go to next event when event is deleted (if next event exists)</li>
<li>[done] Add option to turn off delete event warning</li>
<li>[done] Implement second layer of blinding with 'parts' to evenly distribute random chunks through file</li>
<li>[done] Finish sorting event columns when clicked. Need to insert str(), int(), float() to do this.</li>
<li>[done] Just always sort events by frameStart.</li>
<li>[done] Implement 'delete event'. Add dialog to ask if ok.</li>
<li>[done] Sort events after setting first frame</li>
<li>[done] Add differnet small/big step for chunk edit</li>
<li>[done] Standardize chunk index. I am showing random index in chunk interface but absolute chunk index in event list.</li>
<li>Now building standalone app with pyinstaller</li>
<li>Added video edit icon</li>
<li>[hopefully done, bug] Make sure chunk navigation is working: &gt;, &lt;, go to.</li>
<li>[hopefully done, bug] frame slider gets corrupted and does not move during chunk editing</li>
<li>[hopefully done, bug] Make sure video controls (buttons and keyboard) stay within chunk when 'Limit Controls' is on.</li>
<li>[done] Need some way to 1) categorize/file each event into its chunk 2) detect events falling outside a chunk.</li>
<li>[done] During chunk editing, hijack ALL video controls (frame slider, play, &gt;, &gt;&gt;, &lt;, &lt;&lt;) to only allow scrolling through frames in current chunk.</li>
<li>[done] Add checkbox to activate/inactivate chunk editing.</li>
<li>[done] Running video faster/slower using +/- increments frame interval, it should increment frames per second (+/- 5 fps). Maximum fps for tkinter seems to be ~90 fps. </li>
<li>[done] Implement saving/loading options via JSON file. Include window geometry, show/hide, (MAYBE) mapping of event numbers to names.</li>
<li>[done] Toggle 'play' button to reflect state e.g. play and pause.</li>
<li>[done] Add option to hide video controls like we hide video file list and event list.</li>
<li>[done] Add information about video file to saved event list .txt file, e.g. (path=xxx, numframes=yyy, fps=zzz).</li>
<li>[done] Expand code to open a folder of video files. Right now it is one hard-coded video file.</li>
<li>[done] Add standard video control buttons like play/pause/forward/backward/large-forward/large-backward.</li>
<li>[done] Finish setting event notes with keyboard 'n'.</li>
<li>[done] Write recipe for installation into Python virtual environment.</li>
<li>[done] Design system where events can have start/stop frames or start frame and number of frames (duration). Right now events only have single (start) frame.</li>
</ul>
<h2 id="troubleshooting">Troubleshooting</h2>
<h3 id="standalone-app">Standalone app</h3>
<ul>
<li>Right-click the .app and select 'Show Package Contents'</li>
<li>Run the app directly by double-clicking 'Contents - macOS - VideoAnnotate'.</li>
</ul>
<p>This will run the app with a text console showing feedback on the state of the program. If there are errors, they will appear in the text console.</p>
<h3 id="running-from-source">Running from source</h3>
<p>If there are errors when running, check the versions. The video-player requires:</p>
<ul>
<li>Python 3.7 (includes tkinter 8.x)</li>
<li>numpy</li>
<li>opencv 3</li>
<li>Pillow</li>
</ul>
<p>Check Python version with 'python --version'.</p>
<p>Check Python libraries with 'pip3 freeze'.</p>
<pre><code>numpy==1.15.4
Pillow==5.3.0
</code></pre>
<p>If having problems with opencv, try both installing into Python 'pip3 install opencv-python' and/or installing with brew with 'brew install opencv3 --with-python3'.</p>
<p>The opencv version should be 'opencv-python==3.4.3.18' or newer.</p>
<h2 id="old-install">old - Install</h2>
<h3 id="old-install-using-install-player-script">old - Install - Using 'install-player' script</h3>
<p>This install recipe assumes you have Python 3.7, pip, virtualenv, homebrew, and git installed on your computer. If you do not have these things or have no idea what we are talking about, then please see the <a href="#step_by_step_install">Install - Step By Step</a> section below.</p>
<ol>
<li>Clone repository</li>
</ol>
<pre><code>cd ~
git clone https://github.com/cudmore/pie-analysis.git
</code></pre>
<ol>
<li>Install video-player</li>
</ol>
<pre><code>cd pie-analysis/video-player
./install-player
</code></pre>
<ol>
<li>Run</li>
</ol>
<pre><code>cd pie-analysis/video-player
./player
</code></pre>
<h3 id="old-install-using-requirements-file">old - Install - Using requirements file</h3>
<p>Requires Python 3.7, Open CV 3, Pillow (PIL), Numpy</p>
<pre><code>git clone https://github.com/cudmore/pie-analysis.git
cd pie-analysis/video-player
mkdir player_env
virtualenv -p python3 --no-site-packages player_env
source player_env/bin/activate
pip install -r requirements.txt

# run the player
cd src
python3 VideoApp.py
</code></pre>
<h3 id="old-install-step-by-step">old - Install - Step By Step</h3>
<p>You will install the following</p>
<ul>
<li><a href="https://brew.sh/">Homebrew</a></li>
<li><a href="https://www.python.org/">Python 3.7</a></li>
<li><a href="https://virtualenv.pypa.io/en/latest/">Virtualenv</a></li>
<li><a href="https://git-scm.com/">Git</a></li>
</ul>
<pre><code># Install homebrew
ruby -e &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)&quot;

# Install Python 3.7
brew install python

# Upgrade to Python 3.7
brew upgrade python

# Check Python 3.7 is installed, should return 'Python 3.7.1' or 'Python 3.7.2'
python3 --version

# install virtualenv if necessary
pip3 install virtualenv

# Install git if necessary
brew install git
</code></pre>
<p>Clone the repository</p>
<pre><code>git clone https://github.com/cudmore/pie-analysis.git
</code></pre>
<p>Run the provided installer</p>
<pre><code>cd pie-analysis/video-play
./install-player
</code></pre>
<p>You should now be able to run the video-player with</p>
<pre><code>python src/VideoApp.py
</code></pre>
<p>If that does not work, create your own virtual environment and run from there.</p>
<pre><code># Create a Python 3 virtual environment in 'player_env'.
cd ~/pie-analysis/video-player
mkdir player_env
virtualenv -p python3 --no-site-packages player_env

# activate the virtual environment
# Once activated, command line should begin with '(player_env)'
source player_env/bin/activate

# install with pip
pip install -r requirements.txt

# finally, run the player with
python3 src/player.py
</code></pre>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant"], "search": "../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.5a2dcb6a.min.js"></script>
      
        <script src="../javascripts/extra.js"></script>
      
    
    
  </body>
</html>